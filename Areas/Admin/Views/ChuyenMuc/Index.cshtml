@model IEnumerable<WEB.Models.ChuyenMuc>
@{
    ViewData["Title"] = "Quản lý Danh mục";
    var items = Model?.ToList() ?? new List<WEB.Models.ChuyenMuc>();
}

<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="h3 m-0">Quản lý Danh mục</h1>
        <div class="d-flex gap-2">
            <a class="btn btn-outline-secondary"
               asp-area="Admin" asp-controller="Dashboard" asp-action="Index">
                <i class="fa-solid fa-arrow-left me-1"></i> Về Dashboard
            </a>
            <a class="btn btn-primary" asp-area="Admin" asp-controller="ChuyenMuc" asp-action="Create">
                <i class="fa fa-plus me-1"></i> Thêm danh mục
            </a>
        </div>
    </div>

    <!-- Toolbar: search + stat -->
    <div class="row g-3 mb-3">
        <div class="col-12 col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <label class="form-label mb-1">Tìm kiếm danh mục</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-search"></i></span>
                        <input id="searchBox" type="text" class="form-control" placeholder="Nhập tên hoặc mô tả để lọc nhanh..." />
                        <button class="btn btn-outline-secondary" id="clearSearch" type="button">Xoá</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <div>
                        <div class="text-muted small">Tổng danh mục</div>
                        <div class="fs-3 fw-bold">@items.Count</div>
                    </div>
                    <i class="fa fa-list fa-2xl text-primary"></i>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <div>
                        <div class="text-muted small">Mô tả không rỗng</div>
                        <div class="fs-3 fw-bold">@items.Count(x => !string.IsNullOrWhiteSpace(x.MoTa))</div>
                    </div>
                    <i class="fa fa-paragraph fa-2xl text-info"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Table -->
    <div class="card shadow-sm border-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width:90px">ID</th>
                        <th style="min-width:260px">Tên chuyên mục</th>
                        <th>Mô tả</th>
                        <th style="width:180px" class="text-center">Thao tác</th>
                    </tr>
                </thead>
        <tbody id="catTableBody">
        @if (!items.Any())
        {
            <tr>
                <td colspan="4" class="text-center text-muted py-5">
                    Chưa có danh mục nào. <a asp-area="Admin" asp-controller="ChuyenMuc" asp-action="Create">Thêm mới ngay</a>.
                </td>
            </tr>
        }
        else
        {
            foreach (var c in items.OrderByDescending(x => x.ChuyenMucID))
            {
                <tr class="cat-row">
                    <td class="text-muted">#@c.ChuyenMucID</td>
                    <td class="fw-semibold">@c.TenChuyenMuc</td>
                    <td class="text-muted">@c.MoTa</td>
                    <td class="text-center">
                        <div class="btn-group btn-group-sm post-actions">
                            <a class="btn btn-soft-primary btn-pill px-3"
                               asp-area="Admin" asp-controller="ChuyenMuc" asp-action="Edit" asp-route-id="@c.ChuyenMucID">
                                <i class="fa fa-pen me-1"></i> Sửa
                            </a>
                            <a class="btn btn-soft-danger btn-pill px-3"
                               asp-area="Admin" asp-controller="ChuyenMuc" asp-action="Delete" asp-route-id="@c.ChuyenMucID">
                                <i class="fa fa-trash me-1"></i> Xoá
                            </a>
                        </div>
                    </td>
                </tr>
            }
        }
        </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts{
<script>
(() => {
  const searchBox = document.getElementById('searchBox');
  const clearBtn  = document.getElementById('clearSearch');
  const rows = [...document.querySelectorAll('#catTableBody .cat-row')];

  const filter = () => {
    const q = (searchBox.value || '').toLowerCase().trim();
    rows.forEach(tr => {
      const text = tr.innerText.toLowerCase();
      tr.style.display = text.indexOf(q) >= 0 ? '' : 'none';
    });
  };

  searchBox?.addEventListener('input', filter);
  clearBtn?.addEventListener('click', () => { searchBox.value = ''; filter(); });
})();
</script>
}
